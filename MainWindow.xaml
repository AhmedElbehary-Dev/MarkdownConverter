<Window x:Class="MarkdownConverter.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:controls="clr-namespace:MarkdownConverter.Controls"
        xmlns:models="clr-namespace:MarkdownConverter.Models"
        xmlns:vm="clr-namespace:MarkdownConverter.ViewModels"
        Title="Markdown Converter Pro"
        Width="1040"
        Height="664"
        MinWidth="1040"
        MinHeight="664"
        MaxWidth="1040"
        MaxHeight="664"
        ResizeMode="NoResize"
        WindowStyle="SingleBorderWindow"
        Background="{StaticResource BrushBg}"
        FontFamily="{StaticResource FontPrimary}"
        WindowStartupLocation="CenterScreen"
        Icon="img/md_converter.ico"
        UseLayoutRounding="True"
        AllowDrop="True"
        PreviewDragOver="Window_PreviewDragOver"
        PreviewDragLeave="Window_PreviewDragLeave"
        Drop="Window_Drop">
    <Window.Resources>
        <Style x:Key="StatusTextStyle" TargetType="TextBlock" BasedOn="{StaticResource HelperTextStyle}">
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Foreground" Value="{StaticResource BrushMuted}" />
            <Style.Triggers>
                <DataTrigger Binding="{Binding StatusKind}" Value="{x:Static vm:StatusKind.Info}">
                    <Setter Property="Foreground" Value="{StaticResource BrushAccent}" />
                </DataTrigger>
                <DataTrigger Binding="{Binding StatusKind}" Value="{x:Static vm:StatusKind.Success}">
                    <Setter Property="Foreground" Value="{StaticResource BrushSuccess}" />
                </DataTrigger>
                <DataTrigger Binding="{Binding StatusKind}" Value="{x:Static vm:StatusKind.Error}">
                    <Setter Property="Foreground" Value="{StaticResource BrushDanger}" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="ToastStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource BrushSuccess}" />
            <Setter Property="CornerRadius" Value="10" />
            <Setter Property="Padding" Value="12,8" />
            <Setter Property="BorderBrush" Value="{StaticResource BrushBorder}" />
            <Setter Property="BorderThickness" Value="1" />
            <Style.Triggers>
                <DataTrigger Binding="{Binding ToastKind}" Value="{x:Static vm:ToastKind.Error}">
                    <Setter Property="Background" Value="{StaticResource BrushDanger}" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="DropZoneBorderStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource BrushSurface2}" />
            <Setter Property="BorderBrush" Value="{StaticResource BrushBorder}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="{StaticResource CornerControl}" />
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsDropZoneActive}" Value="True">
                    <Setter Property="BorderBrush" Value="{StaticResource BrushFocus}" />
                    <Setter Property="Background" Value="#121C33" />
                </DataTrigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Opacity" Value="0.6" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="DropZoneDashStyle" TargetType="Rectangle">
            <Setter Property="Stroke" Value="{StaticResource BrushBorder}" />
            <Setter Property="StrokeThickness" Value="1" />
            <Setter Property="StrokeDashArray" Value="4 4" />
            <Setter Property="RadiusX" Value="10" />
            <Setter Property="RadiusY" Value="10" />
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsDropZoneActive}" Value="True">
                    <Setter Property="Stroke" Value="{StaticResource BrushFocus}" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <DataTemplate x:Key="FormatOptionTemplate" DataType="{x:Type models:FormatOption}">
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                <Border x:Name="FormatBadge"
                        Width="16"
                        Height="16"
                        CornerRadius="4"
                        Background="Transparent"
                        BorderThickness="0"
                        Margin="0,0,8,0">
                    <Path x:Name="FormatIcon"
                          Width="12"
                          Height="12"
                          Stretch="Uniform"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Center"
                          StrokeThickness="1.3"
                          Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=ListBoxItem}}"
                          Fill="Transparent" />
                </Border>
                <TextBlock Text="{Binding Label}"
                           Foreground="{Binding Foreground, RelativeSource={RelativeSource AncestorType=ListBoxItem}}" />
            </StackPanel>
            <DataTemplate.Triggers>
                <DataTrigger Binding="{Binding Value}" Value="{x:Static models:OutputFormat.Pdf}">
                    <Setter TargetName="FormatIcon" Property="Data" Value="{StaticResource IconPdf}" />
                </DataTrigger>
                <DataTrigger Binding="{Binding Value}" Value="{x:Static models:OutputFormat.Word}">
                    <Setter TargetName="FormatIcon" Property="Data" Value="{StaticResource IconWord}" />
                </DataTrigger>
                <DataTrigger Binding="{Binding Value}" Value="{x:Static models:OutputFormat.Excel}">
                    <Setter TargetName="FormatIcon" Property="Data" Value="{StaticResource IconExcel}" />
                </DataTrigger>
            </DataTemplate.Triggers>
        </DataTemplate>
    </Window.Resources>

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0"
                Background="{StaticResource BrushSurface}"
                BorderBrush="{StaticResource BrushBorder}"
                BorderThickness="1"
                CornerRadius="{StaticResource CornerCard}"
                Padding="16,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <Border Width="48"
                        Height="48"
                        Background="{StaticResource BrushSurface2}"
                        BorderBrush="{StaticResource BrushBorder}"
                        BorderThickness="1"
                        CornerRadius="10"
                        VerticalAlignment="Center">
                    <Image Source="img/md_converter.png" Stretch="Uniform" Margin="8" />
                </Border>

                <StackPanel Grid.Column="1"
                            Orientation="Horizontal"
                            VerticalAlignment="Center"
                            Margin="16,0,0,0">
                    <TextBlock Text="{Binding AppTitle}"
                               FontSize="20"
                               FontWeight="SemiBold"
                               VerticalAlignment="Center" />
                    <Border Background="{StaticResource BrushSurface2}"
                            BorderBrush="{StaticResource BrushBorder}"
                            BorderThickness="1"
                            CornerRadius="8"
                            Padding="8,4"
                            Margin="8,0,0,0"
                            VerticalAlignment="Center">
                        <TextBlock Text="{Binding AppVersion}"
                                   Style="{StaticResource HelperTextStyle}"
                                   VerticalAlignment="Center" />
                    </Border>
                </StackPanel>

                <StackPanel Grid.Column="3"
                            Orientation="Horizontal"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Center">
                    <controls:FlatButton Style="{StaticResource IconButtonHeaderStyle}" ToolTip="Settings">
                        <TextBlock FontFamily="Segoe MDL2 Assets"
                                   Text="&#xE713;"
                                   FontSize="16"
                                   Foreground="{StaticResource BrushText}" />
                    </controls:FlatButton>
                    <controls:FlatButton Style="{StaticResource IconButtonHeaderStyle}" ToolTip="Theme" Margin="8,0,0,0">
                        <TextBlock FontFamily="Segoe MDL2 Assets"
                                   Text="&#xE706;"
                                   FontSize="16"
                                   Foreground="{StaticResource BrushText}" />
                    </controls:FlatButton>
                    <controls:FlatButton Style="{StaticResource IconButtonHeaderStyle}" ToolTip="Collapse" Margin="8,0,0,0">
                        <TextBlock FontFamily="Segoe MDL2 Assets"
                                   Text="&#xE70E;"
                                   FontSize="16"
                                   Foreground="{StaticResource BrushText}" />
                    </controls:FlatButton>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main content -->
        <Grid Grid.Row="1" Margin="0,16,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="3*" />
                <ColumnDefinition Width="20" />
                <ColumnDefinition Width="2*" />
            </Grid.ColumnDefinitions>

            <!-- Left column -->
            <StackPanel Grid.Column="0" Orientation="Vertical">
                <controls:Card Margin="0,0,0,16">
                    <controls:Card.Header>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Input file" Style="{StaticResource CardHeaderTextStyle}" />
                            <TextBlock Grid.Column="1"
                                       Text=".md, markdown"
                                       Style="{StaticResource HelperTextStyle}"
                                       VerticalAlignment="Center" />
                        </Grid>
                    </controls:Card.Header>
                    <StackPanel>
                        <Border Height="216"
                                Style="{StaticResource DropZoneBorderStyle}"
                                AllowDrop="True"
                                Cursor="Hand"
                                IsEnabled="{Binding IsBusy, Converter={StaticResource BoolNot}}"
                                PreviewDragEnter="DropZone_PreviewDragEnter"
                                PreviewDragOver="DropZone_PreviewDragOver"
                                PreviewDragLeave="DropZone_PreviewDragLeave"
                                PreviewDrop="DropZone_PreviewDrop"
                                MouseLeftButtonUp="DropZone_MouseLeftButtonUp">
                            <Grid Background="Transparent">
                                <Rectangle Style="{StaticResource DropZoneDashStyle}" Margin="16" />
                                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                    <Border Width="64"
                                            Height="64"
                                            Background="{StaticResource BrushSurface}"
                                            BorderBrush="{StaticResource BrushBorder}"
                                            BorderThickness="1"
                                            CornerRadius="12"
                                            Margin="0,0,0,8">
                                        <Path Data="{StaticResource IconFileArrow}"
                                              Stroke="{StaticResource BrushMuted}"
                                              StrokeThickness="1.4"
                                              Fill="Transparent"
                                              Stretch="Uniform"
                                              Margin="8" />
                                    </Border>
                                    <TextBlock Text="Drag &amp; drop your markdown file here"
                                               Style="{StaticResource BodyTextStyle}"
                                               HorizontalAlignment="Center" />
                                    <TextBlock Style="{StaticResource HelperTextStyle}"
                                               HorizontalAlignment="Center"
                                               Margin="0,8,0,0">
                                        <Run Text="or click " />
                                        <Hyperlink Command="{Binding BrowseCommand}">
                                            <Run Text="Browse" />
                                        </Hyperlink>
                                    </TextBlock>
                                </StackPanel>
                            </Grid>
                        </Border>

                    </StackPanel>
                </controls:Card>

                <controls:Card>
                    <controls:Card.Header>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Conversion Status" Style="{StaticResource CardHeaderTextStyle}" />
                            <TextBlock Grid.Column="1"
                                       Text="{Binding StatusText}"
                                       Style="{StaticResource StatusTextStyle}"
                                       VerticalAlignment="Center"
                                       TextTrimming="CharacterEllipsis"
                                       MaxWidth="160" />
                        </Grid>
                    </controls:Card.Header>
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <Ellipse Width="8"
                                     Height="8"
                                     Stroke="{StaticResource BrushMuted}"
                                     Fill="{StaticResource BrushSurface2}"
                                     Margin="0,0,8,0" />
                            <TextBlock Text="{Binding SelectedFormatLabel}"
                                       FontSize="13"
                                       FontWeight="SemiBold"
                                       Foreground="{StaticResource BrushText}" />
                        </StackPanel>
                        <ProgressBar Style="{StaticResource FlatProgressBar}"
                                     Minimum="0"
                                     Maximum="100"
                                     Value="{Binding Progress, Mode=OneWay}"
                                     IsIndeterminate="{Binding IsBusy}" />
                        <Grid Margin="0,16,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="8" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <Border Background="{StaticResource BrushSurface2}"
                                    BorderBrush="{StaticResource BrushBorder}"
                                    BorderThickness="1"
                                    CornerRadius="{StaticResource CornerControl}"
                                    Padding="16,8">
                                <DockPanel LastChildFill="True">
                                    <TextBlock Text="Output:"
                                               Style="{StaticResource HelperTextStyle}"
                                               Margin="0,0,8,0" />
                                    <TextBlock Text="{Binding OutputFilePath}"
                                               TextWrapping="NoWrap"
                                               TextTrimming="CharacterEllipsis"
                                               ToolTip="{Binding OutputFilePath}" />
                                </DockPanel>
                            </Border>
                            <controls:FlatButton Grid.Column="2"
                                                 Style="{StaticResource IconButtonSmallStyle}"
                                                 Command="{Binding CopyOutputCommand}"
                                                 VerticalAlignment="Center">
                                <TextBlock FontFamily="Segoe MDL2 Assets"
                                           Text="&#xE8C8;"
                                           FontSize="14"
                                           Foreground="{StaticResource BrushText}" />
                            </controls:FlatButton>
                        </Grid>
                    </StackPanel>
                </controls:Card>
            </StackPanel>

            <!-- Right column -->
            <StackPanel Grid.Column="2" Orientation="Vertical">
                <controls:Card Margin="0,0,0,16">
                    <controls:Card.Header>
                        <TextBlock Text="Output" Style="{StaticResource CardHeaderTextStyle}" />
                    </controls:Card.Header>
                    <StackPanel>
                        <controls:SegmentedControl ItemsSource="{Binding Formats}"
                                                   SelectedValue="{Binding SelectedFormat}"
                                                   SelectedValuePath="Value"
                                                   ItemTemplate="{StaticResource FormatOptionTemplate}"
                                                   IsEnabled="{Binding IsBusy, Converter={StaticResource BoolNot}}" />

                        <TextBlock Text="Save to"
                                   Style="{StaticResource BodyTextStyle}"
                                   Margin="0,16,0,8" />

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="8" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="8" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <controls:FlatTextBox Text="{Binding OutputFolder}"
                                                  IsEnabled="{Binding IsBusy, Converter={StaticResource BoolNot}}" />
                            <controls:FlatButton Grid.Column="2"
                                                 Style="{StaticResource IconButtonStyle}"
                                                 Command="{Binding BrowseOutputFolderCommand}"
                                                 IsEnabled="{Binding IsBusy, Converter={StaticResource BoolNot}}">
                                <TextBlock FontFamily="Segoe MDL2 Assets"
                                           Text="&#xE8B7;"
                                           FontSize="16"
                                           Foreground="{StaticResource BrushText}" />
                            </controls:FlatButton>
                            <controls:FlatButton Grid.Column="4"
                                                 Style="{StaticResource FlatButtonSecondary}"
                                                 Content="Open"
                                                 Width="88"
                                                 Command="{Binding OpenOutputFolderCommand}"
                                                 IsEnabled="{Binding IsBusy, Converter={StaticResource BoolNot}}" />
                        </Grid>

                        <StackPanel Margin="0,16,0,0">
                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Open file after convert" Style="{StaticResource BodyTextStyle}" />
                                <controls:ToggleSwitch Grid.Column="1"
                                                       IsChecked="{Binding OpenAfterConvert}"
                                                       IsEnabled="{Binding IsBusy, Converter={StaticResource BoolNot}}" />
                            </Grid>
                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Overwrite if exists" Style="{StaticResource BodyTextStyle}" />
                                <controls:ToggleSwitch Grid.Column="1"
                                                       IsChecked="{Binding OverwriteIfExists}"
                                                       IsEnabled="{Binding IsBusy, Converter={StaticResource BoolNot}}" />
                            </Grid>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Preserve folder structure" Style="{StaticResource BodyTextStyle}" />
                                <controls:ToggleSwitch Grid.Column="1"
                                                       IsChecked="{Binding PreserveStructure}"
                                                       IsEnabled="{Binding IsBusy, Converter={StaticResource BoolNot}}" />
                            </Grid>
                        </StackPanel>
                    </StackPanel>
                </controls:Card>

                <controls:Card>
                    <controls:Card.Header>
                        <TextBlock Text="Actions" Style="{StaticResource CardHeaderTextStyle}" />
                    </controls:Card.Header>
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <controls:FlatButton Content="Convert"
                                                 Command="{Binding ConvertCommand}"
                                                 Width="128" />
                            <controls:FlatButton Content="Clear"
                                                 Style="{StaticResource FlatButtonSecondary}"
                                                 Command="{Binding ClearCommand}"
                                                 Width="96"
                                                 Margin="8,0,0,0"
                                                 IsEnabled="{Binding IsBusy, Converter={StaticResource BoolNot}}" />
                        </StackPanel>
                        <TextBlock Text="Tip: You can drag &amp; drop a file anywhere in the window."
                                   Style="{StaticResource HelperTextStyle}"
                                   Margin="0,16,0,0" />
                    </StackPanel>
                </controls:Card>
            </StackPanel>
        </Grid>

        <!-- Toast -->
        <Border Style="{StaticResource ToastStyle}"
                Grid.RowSpan="2"
                HorizontalAlignment="Right"
                VerticalAlignment="Bottom"
                Margin="0"
                Visibility="{Binding IsToastVisible, Converter={StaticResource BoolToVisibility}}">
            <TextBlock Text="{Binding ToastMessage}" Foreground="{StaticResource BrushText}" />
        </Border>
    </Grid>
</Window>
