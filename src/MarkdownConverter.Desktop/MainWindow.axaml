<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:conv="using:MarkdownConverter.Desktop.Converters"
        xmlns:vm="clr-namespace:MarkdownConverter.ViewModels;assembly=MarkdownConverter.Core"
        x:Class="MarkdownConverter.Desktop.MainWindow"
        mc:Ignorable="d"
        Width="980"
        Height="700"
        MinWidth="840"
        MinHeight="620"
        Title="Markdown Converter Pro"
        Icon="avares://MarkdownConverter.Desktop/Assets/md_converter.ico"
        Background="{DynamicResource AppBgBrush}">
  <Window.Resources>
    <conv:BooleanNegationConverter x:Key="BoolNot" />
    <conv:StatusKindToBrushConverter x:Key="StatusBrush" />
    <conv:ToastKindToBrushConverter x:Key="ToastBrush" />
  </Window.Resources>

  <Window.Styles>
    <Style Selector="TextBlock">
      <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
    </Style>

    <Style Selector="Border.card">
      <Setter Property="Background" Value="{DynamicResource PanelBrush}" />
      <Setter Property="BorderBrush" Value="{DynamicResource StrokeBrush}" />
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="CornerRadius" Value="14" />
    </Style>

    <Style Selector="Border.subtle">
      <Setter Property="Background" Value="{DynamicResource PanelAltBrush}" />
      <Setter Property="BorderBrush" Value="{DynamicResource StrokeBrush}" />
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="CornerRadius" Value="10" />
    </Style>

    <Style Selector="Button">
      <Setter Property="Background" Value="{DynamicResource PanelInsetBrush}" />
      <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
      <Setter Property="BorderBrush" Value="{DynamicResource StrokeBrush}" />
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="CornerRadius" Value="8" />
      <Setter Property="Padding" Value="12,8" />
    </Style>

    <Style Selector="Button:pointerover">
      <Setter Property="Background" Value="#4B5463" />
      <Setter Property="BorderBrush" Value="#617086" />
    </Style>

    <Style Selector="Button:pressed">
      <Setter Property="Background" Value="#3A4351" />
    </Style>

    <Style Selector="Button.primary">
      <Setter Property="Background" Value="{DynamicResource AccentBrush}" />
      <Setter Property="Foreground" Value="#091318" />
      <Setter Property="BorderBrush" Value="#34D2D9" />
      <Setter Property="FontWeight" Value="SemiBold" />
    </Style>

    <Style Selector="Button.primary:pointerover">
      <Setter Property="Background" Value="{DynamicResource AccentStrongBrush}" />
      <Setter Property="BorderBrush" Value="#5EE4EA" />
    </Style>

    <Style Selector="Button.flat">
      <Setter Property="Background" Value="Transparent" />
      <Setter Property="BorderBrush" Value="{DynamicResource StrokeBrush}" />
    </Style>

    <Style Selector="TextBox">
      <Setter Property="Background" Value="#202733" />
      <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
      <Setter Property="BorderBrush" Value="{DynamicResource StrokeBrush}" />
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="CornerRadius" Value="8" />
      <Setter Property="Padding" Value="10,8" />
    </Style>

    <Style Selector="ComboBox">
      <Setter Property="Background" Value="#202733" />
      <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
      <Setter Property="BorderBrush" Value="{DynamicResource StrokeBrush}" />
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="CornerRadius" Value="8" />
    </Style>

    <Style Selector="CheckBox">
      <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
    </Style>

    <Style Selector="ProgressBar">
      <Setter Property="Foreground" Value="{DynamicResource AccentBrush}" />
      <Setter Property="Background" Value="#1A2029" />
      <Setter Property="BorderBrush" Value="{DynamicResource StrokeBrush}" />
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="CornerRadius" Value="999" />
    </Style>
  </Window.Styles>

  <Grid RowDefinitions="Auto,*,Auto" Margin="18">
    <Border Grid.RowSpan="3"
            Background="{DynamicResource AppBgBrush}"
            CornerRadius="18" />

    <Border Grid.RowSpan="3"
            Margin="-40,-60,-40,120"
            IsHitTestVisible="False"
            Opacity="0.08"
            Background="{DynamicResource AccentBrush}"
            CornerRadius="240" />

    <Border Grid.Row="0" Classes="card" Padding="16">
      <Grid ColumnDefinitions="Auto,*,Auto">
        <Border Width="72"
                Height="72"
                CornerRadius="16"
                Background="White"
                BorderBrush="{DynamicResource StrokeBrush}"
                BorderThickness="1">
          <Image Source="avares://MarkdownConverter.Desktop/Assets/md_converter.png" Stretch="Uniform" Margin="8" />
        </Border>

        <StackPanel Grid.Column="1" Spacing="2" VerticalAlignment="Center" Margin="16,0,16,0">
          <TextBlock Text="{Binding AppTitle}" FontSize="22" FontWeight="SemiBold" />
          <TextBlock Text="{Binding AppVersion}" Foreground="{DynamicResource TextMutedBrush}" FontSize="12" />
        </StackPanel>

        <Border Grid.Column="2" Classes="subtle" VerticalAlignment="Center" Padding="12,6">
          <TextBlock Text="{Binding StatusText}"
                     Foreground="{Binding StatusKind, Converter={StaticResource StatusBrush}}"
                     FontWeight="SemiBold" />
        </Border>
      </Grid>
    </Border>

    <Grid Grid.Row="1" Margin="0,16,0,12" ColumnDefinitions="*,18,344">
      <StackPanel Grid.Column="0" Spacing="16">
        <Border x:Name="DropZone"
                Classes="card"
                Padding="18"
                IsEnabled="{Binding IsBusy, Converter={StaticResource BoolNot}}"
                PointerReleased="DropZone_PointerReleased"
                DragDrop.AllowDrop="True"
                DragDrop.DragOver="DropZone_DragOver"
                DragDrop.DragLeave="DropZone_DragLeave"
                DragDrop.Drop="DropZone_Drop">
          <StackPanel Spacing="12" HorizontalAlignment="Center" VerticalAlignment="Center">
            <Border Classes="subtle" Width="54" Height="54" CornerRadius="14" HorizontalAlignment="Center">
              <TextBlock Text="MD"
                         HorizontalAlignment="Center"
                         VerticalAlignment="Center"
                         FontWeight="Bold"
                         Foreground="{DynamicResource AccentStrongBrush}" />
            </Border>

            <TextBlock Text="Drop markdown file here"
                       FontWeight="SemiBold"
                       FontSize="16"
                       HorizontalAlignment="Center" />
            <TextBlock Text=".md or .markdown"
                       Foreground="{DynamicResource TextSecondaryBrush}"
                       HorizontalAlignment="Center" />
            <Button Content="Browse"
                    Classes="primary"
                    Command="{Binding BrowseCommand}"
                    HorizontalAlignment="Center" />
            <TextBlock Text="{Binding SelectedMarkdownPath}"
                       Foreground="{DynamicResource TextSecondaryBrush}"
                       TextWrapping="Wrap"
                       HorizontalAlignment="Center"
                       MaxWidth="520" />
          </StackPanel>
        </Border>

        <Border Classes="card" Padding="16">
          <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto">
            <Grid ColumnDefinitions="*,Auto">
              <TextBlock Text="Progress" FontWeight="SemiBold" FontSize="15" />
              <TextBlock Grid.Column="1"
                         Text="{Binding Progress, StringFormat={}{0:0}%}"
                         Foreground="{DynamicResource TextSecondaryBrush}"
                         FontWeight="SemiBold" />
            </Grid>

            <ProgressBar Grid.Row="1"
                         Minimum="0"
                         Maximum="100"
                         Value="{Binding Progress}"
                         Height="12"
                         Margin="0,12,0,0" />

            <TextBlock Grid.Row="2"
                       Text="{Binding OutputFilePath}"
                       Foreground="{DynamicResource TextSecondaryBrush}"
                       TextWrapping="Wrap"
                       Margin="0,12,0,0" />

            <StackPanel Grid.Row="3" Orientation="Horizontal" Spacing="8" Margin="0,12,0,0">
              <Button Content="Copy Output Path" Command="{Binding CopyOutputCommand}" />
              <Button Content="Open Output Folder" Command="{Binding OpenOutputFolderCommand}" />
            </StackPanel>

            <StackPanel Grid.Row="4" Orientation="Horizontal" Spacing="12" Margin="0,12,0,0">
              <CheckBox Content="Open after convert" IsChecked="{Binding OpenAfterConvert}" />
              <CheckBox Content="Overwrite existing" IsChecked="{Binding OverwriteIfExists}" />
              <CheckBox Content="Preserve structure" IsChecked="{Binding PreserveStructure}" />
            </StackPanel>

            <Border Grid.Row="5" Classes="subtle" Margin="0,14,0,0" Padding="10">
              <Grid ColumnDefinitions="*,Auto,Auto">
                <TextBlock Text="Ready to convert selected markdown to the chosen format."
                           VerticalAlignment="Center"
                           Foreground="{DynamicResource TextSecondaryBrush}" />
                <Button Grid.Column="1" Content="Clear" Classes="flat" Command="{Binding ClearCommand}" Margin="8,0,0,0" />
                <Button Grid.Column="2" Content="Convert" Classes="primary" Command="{Binding ConvertCommand}" Margin="8,0,0,0" />
              </Grid>
            </Border>
          </Grid>
        </Border>
      </StackPanel>

      <Border Grid.Column="2" Classes="card" Padding="16">
        <StackPanel Spacing="14">
          <Border Background="#1F2631" CornerRadius="10" Padding="10,8">
            <TextBlock Text="Conversion Options" FontWeight="SemiBold" FontSize="16" />
          </Border>

          <StackPanel Spacing="6">
            <TextBlock Text="Output Format" Foreground="{DynamicResource TextSecondaryBrush}" />
            <ComboBox ItemsSource="{Binding Formats}"
                      SelectedValue="{Binding SelectedFormat}"
                      SelectedValueBinding="{Binding Value}">
              <ComboBox.ItemTemplate>
                <DataTemplate>
                  <TextBlock Text="{Binding Label}" />
                </DataTemplate>
              </ComboBox.ItemTemplate>
            </ComboBox>
          </StackPanel>

          <StackPanel Spacing="6">
            <TextBlock Text="Output Folder" Foreground="{DynamicResource TextSecondaryBrush}" />
            <TextBox Text="{Binding OutputFolder}" />
            <Button Content="Browse Folder"
                    Command="{Binding BrowseOutputFolderCommand}"
                    HorizontalAlignment="Left" />
          </StackPanel>

          <Border Classes="subtle" Padding="12">
            <StackPanel Spacing="6">
              <TextBlock Text="Feature Parity Checklist" FontWeight="SemiBold" />
              <TextBlock Text="• Drag and drop input" Foreground="{DynamicResource TextSecondaryBrush}" />
              <TextBlock Text="• Browse file and folder" Foreground="{DynamicResource TextSecondaryBrush}" />
              <TextBlock Text="• Copy and open output path" Foreground="{DynamicResource TextSecondaryBrush}" />
              <TextBlock Text="• Progress, toast, and modal result" Foreground="{DynamicResource TextSecondaryBrush}" />
              <TextBlock Text="• PDF, DOCX, XLSX conversion via existing core"
                         Foreground="{DynamicResource TextSecondaryBrush}"
                         TextWrapping="Wrap" />
            </StackPanel>
          </Border>

        </StackPanel>
      </Border>
    </Grid>

    <Border Grid.Row="2"
            IsVisible="{Binding IsToastVisible}"
            Background="{Binding ToastKind, Converter={StaticResource ToastBrush}}"
            BorderBrush="{DynamicResource StrokeBrush}"
            BorderThickness="1"
            CornerRadius="10"
            Padding="12,8"
            HorizontalAlignment="Right">
      <TextBlock Text="{Binding ToastMessage}" Foreground="White" />
    </Border>
  </Grid>
</Window>
